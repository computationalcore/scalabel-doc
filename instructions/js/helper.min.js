function addEvent(e,t,n){if(!assignment.events){assignment.events=[]}var a={timestamp:Math.round(new Date/1e3),action:e,targetIndex:t.toString(),position:n};assignment.events.push(a)}function preload(e,t){t=t||0;if(e&&e.length>t){preloaded_images[t]=new Image;preloaded_images[t].onload=function(){addEvent("image loaded",t);preload(e,t+1)};preloaded_images[t].onerror=function(){addEvent("image fails to load",t);alert("Fail when loading images, please contact whom it concerned.")};preloaded_images[t].src=e[t].url;if(t===0){polyLabeling=new PolyLabeling({url:preloaded_images[current_index].src});polyLabeling.updateImage(preloaded_images[current_index].src)}}else{$("#prev_btn").attr("disabled",false);$("#next_btn").attr("disabled",false);console.log("finish preloading all images.")}}function saveLabels(){polyLabeling.submitLabels();image_list[current_index].labels=polyLabeling.output_labels}function updateProgress(){var e=(current_index+1).toString()+"/"+assignment.taskSize.toString();if($("#pagination_control")){var t="";t+='<div class="text-muted" id="progress_percentage">'+e+"</div>";$("#progress_percentage").remove();$("#pagination_control").append(t)}}function submitAssignment(){polyLabeling.submitLabels();image_list[current_index].labels=polyLabeling.output_labels;var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===4){}};assignment.images=image_list;assignment.numLabeledImages=current_index+1;assignment.userAgent=navigator.userAgent;console.log(assignment);e.open("POST","/label/lane/postSubmission");e.send(JSON.stringify(assignment))}function submitLog(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===4){console.log(e.response)}};assignment.images=image_list;assignment.numLabeledImages=current_index+1;assignment.userAgent=navigator.userAgent;e.open("POST","/label/lane/postLog");e.send(JSON.stringify(assignment))}function updateCategory(){var e=Catelist;var t=document.getElementById("category_select");t.setAttribute("size",Catelist.length);if(e.length!==0){for(var n=0;n<e.length;n++){var a=e[n];if(e[n]){$("select#category_select").append("<option>"+e[n]+"</option>")}}$("#category_select").val(e[0]);document.getElementById("name_select").setAttribute("size",Featurelist.length);for(var s=0;s<Featurelist.length;s++)$("select#name_select").append("<option>"+Featurelist[s]+"</option>");$("#name_select").val(Featurelist[0]);document.getElementById("dir_select").setAttribute("size",Dirlist.length);for(var s=0;s<Dirlist.length;s++)$("select#dir_select").append("<option>"+Dirlist[s]+"</option>");$("#dir_select").val(Dirlist[0])}}function loadAssignment(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===4){assignment=JSON.parse(e.response);image_list=assignment.images;addEvent("start labeling",current_index);assignment.startTime=Math.round(new Date/1e3);current_index=0;preload(image_list);updateCategory();getIPAddress();updateProgress();for(var t in image_list){var n=image_list[t].labels;for(var a in n){if(n.hasOwnProperty(a)){var s=n[a];num_poly=num_poly+1}}}$("#poly_count").text(num_poly)}};var t=new URLSearchParams(window.location.search);var n=t.get("task_id");var a=t.get("project_name");var s=JSON.stringify({assignmentId:n,projectName:a});e.open("POST","/label/lane/requestSubmission");e.send(s)}function getIPAddress(){$.getJSON("//ipinfo.io/json",function(e){assignment.ipAddress=e})}